# 右键菜单功能说明

## 🎯 功能概述

新增了右键菜单功能，让您可以直接选中文本，右键选择"🎬 使用 Sora 生成视频"，自动生成视频并下载到本地，同时在笔记中插入视频链接。

## ✨ 新增功能

### 1. 右键菜单选项

-   **触发条件**：选中文本后右键
-   **菜单项**：🎬 使用 Sora 生成视频
-   **图标**：视频图标
-   **功能**：一键生成视频并下载

### 2. 自动化流程

1. **文本选择**：在笔记中选中要生成视频的文本
2. **右键菜单**：右键选择"🎬 使用 Sora 生成视频"
3. **自动生成**：使用默认配置自动生成视频
4. **自动下载**：视频生成完成后自动下载到本地
5. **插入链接**：在选中文本后换行两次，插入视频链接

### 3. 智能文件命名

-   基于选中文本的前 20 个字符生成文件名
-   自动清理特殊字符，使用连字符分隔
-   添加时间戳避免重名
-   格式：`sora-video-{文本内容}-{时间戳}.mp4`

## 🔧 技术实现

### 1. 右键菜单注册

```typescript
this.registerEvent(
	this.app.workspace.on("editor-menu", (menu, editor, view) => {
		const selection = editor.getSelection();
		if (selection.trim()) {
			menu.addItem((item) => {
				item.setTitle("🎬 使用Sora生成视频")
					.setIcon("video")
					.onClick(async () => {
						await this.generateVideoFromSelection(
							selection,
							editor
						);
					});
			});
		}
	})
);
```

### 2. 视频生成流程

-   使用插件默认配置（模型、比例、时长、清晰度）
-   自动轮询生成状态
-   实时显示生成进度
-   生成完成后自动处理结果

### 3. 下载和插入功能

-   自动下载视频到本地
-   在编辑器中插入视频链接
-   换行两次后插入，保持格式整洁
-   支持 Markdown 格式：`![Generated Video](视频链接)`

## 📋 使用步骤

### 基本使用

1. **选中文本**：在笔记中选中要生成视频的文本描述
2. **右键菜单**：右键点击选中的文本
3. **选择功能**：点击"🎬 使用 Sora 生成视频"
4. **等待生成**：系统会显示生成进度通知
5. **自动完成**：视频生成完成后自动下载并插入到笔记中

### 示例

```
原始文本：一只可爱的小猫在花园里玩耍

生成后：
一只可爱的小猫在花园里玩耍


![Generated Video](https://example.com/video.mp4)

```

## ⚙️ 配置说明

右键菜单功能使用插件的默认配置：

-   **模型**：sora-2（可在设置中修改）
-   **比例**：16:9（可在设置中修改）
-   **时长**：10 秒（可在设置中修改）
-   **清晰度**：small（可在设置中修改）

## 🔔 通知说明

-   **开始生成**：显示"开始生成视频，请稍候..."
-   **生成进度**：显示"生成进度: X% (当前次数/最大次数)"
-   **生成成功**：显示"视频生成成功！"
-   **下载完成**：显示"视频已下载: 文件名.mp4"
-   **插入完成**：显示"视频已下载并插入到笔记中"

## 🚨 注意事项

1. **API 配置**：使用前请确保在设置中配置了 API 密钥
2. **网络连接**：确保网络连接稳定，避免生成中断
3. **文本长度**：建议选中文本不要过长，影响生成效果
4. **文件命名**：文件名基于选中文本生成，建议选择有意义的文本
5. **轮询超时**：如果生成时间过长，会显示超时提示

## 🎨 界面效果

-   右键菜单项带有视频图标和 emoji
-   生成过程中显示进度通知
-   自动下载并插入视频链接
-   保持笔记格式整洁

## 🔄 与现有功能的区别

| 功能     | 原有功能            | 右键菜单功能   |
| -------- | ------------------- | -------------- |
| 触发方式 | 功能区图标/命令面板 | 右键菜单       |
| 配置选择 | 手动选择参数        | 使用默认配置   |
| 结果处理 | 手动下载/插入       | 自动下载并插入 |
| 使用场景 | 详细配置生成        | 快速生成       |

## 📈 优势

1. **操作简便**：一键生成，无需手动配置
2. **自动化**：自动下载和插入，减少手动操作
3. **快速生成**：使用默认配置，提高效率
4. **格式整洁**：自动换行两次，保持笔记格式
5. **智能命名**：基于文本内容生成有意义的文件名

---

**功能状态**：✅ 已完成
**测试状态**：✅ 已通过
**兼容性**：✅ 向后兼容
