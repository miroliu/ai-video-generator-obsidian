# 多 API 主机管理功能

## 🎯 功能概述

新增了支持多个 API 主机地址的管理功能，允许用户添加、配置、测试和管理多个 API 服务器。

## ✨ 新增功能

### 1. 多 API 主机支持

-   **预设主机**：默认包含国内直连和海外服务器
-   **自定义主机**：用户可以添加自己的 API 服务器
-   **主机选择**：可以随时切换使用不同的 API 主机
-   **主机管理**：支持启用/禁用、测试连接、删除主机

### 2. 设置界面改进

-   **主机选择器**：下拉菜单选择当前使用的主机
-   **主机列表**：可视化显示所有配置的主机
-   **状态显示**：显示主机的启用/禁用状态
-   **操作按钮**：每个主机都有独立的操作按钮

### 3. 主机管理功能

-   **添加主机**：通过模态框添加新的 API 主机
-   **测试连接**：测试 API 主机的连接状态
-   **启用/禁用**：控制主机的可用性
-   **删除主机**：删除不需要的主机（保护默认主机）

## 🔧 使用方法

### 添加新 API 主机

1. **打开设置页面**

    - 进入 Obsidian 设置
    - 找到 "AI Video Generator 设置"

2. **添加主机**

    - 点击 "➕ 添加新 API 主机" 按钮
    - 填写主机信息：
        - **主机名称**：便于识别的名称
        - **主机 URL**：完整的 API 服务器地址
        - **描述**：可选的描述信息

3. **保存配置**
    - 点击 "添加" 按钮保存
    - 新主机会自动启用并显示在列表中

### 管理现有主机

1. **选择主机**

    - 在 "选择 API 主机" 下拉菜单中选择要使用的主机
    - 只有启用的主机会显示在列表中

2. **测试连接**

    - 点击主机卡片中的 "测试连接" 按钮
    - 系统会发送测试请求验证连接状态
    - 测试结果会通过通知显示

3. **启用/禁用主机**

    - 点击 "启用" 或 "禁用" 按钮
    - 禁用的主机不会出现在选择列表中

4. **删除主机**
    - 点击 "删除" 按钮（仅自定义主机）
    - 默认主机（国内直连、海外服务器）不能删除

## 📋 配置示例

### 默认配置

```json
{
	"apiHosts": [
		{
			"id": "default",
			"name": "国内直连",
			"url": "https://grsai.dakka.com.cn",
			"enabled": true,
			"description": "国内服务器，访问速度快"
		},
		{
			"id": "overseas",
			"name": "海外服务器",
			"url": "https://api.grsai.com",
			"enabled": true,
			"description": "海外服务器，稳定性好"
		}
	],
	"selectedApiHost": "default"
}
```

### 自定义主机示例

```json
{
	"id": "custom_1234567890",
	"name": "备用服务器",
	"url": "https://backup-api.example.com",
	"enabled": true,
	"description": "备用服务器，稳定性好"
}
```

## 🛠️ 技术实现

### 数据结构

-   **ApiHostConfig 接口**：定义主机配置结构
-   **VideoGeneratorSettings 扩展**：添加多主机支持
-   **向后兼容**：保持原有 apiHost 字段的兼容性

### 核心方法

-   **getCurrentApiHost()**：获取当前选中的 API 主机
-   **testApiHost()**：测试主机连接状态
-   **showAddHostModal()**：显示添加主机界面

### 界面组件

-   **主机选择器**：下拉菜单选择主机
-   **主机卡片**：显示主机信息和操作按钮
-   **添加主机模态框**：添加新主机的界面

## 🔍 故障排除

### 常见问题

1. **主机连接失败**

    - 检查 URL 格式是否正确
    - 确认 API 密钥是否有效
    - 测试网络连接状态

2. **主机不显示在选择列表中**

    - 检查主机是否已启用
    - 确认主机配置是否正确

3. **测试连接失败**
    - 检查 API 密钥配置
    - 确认服务器地址可访问
    - 查看控制台错误信息

### 调试步骤

1. **检查设置**

    - 确认 API 密钥已配置
    - 验证主机 URL 格式

2. **测试连接**

    - 使用 "测试连接" 功能
    - 查看通知消息

3. **查看日志**
    - 打开浏览器开发者工具
    - 查看控制台错误信息

## 🚀 未来扩展

### 计划功能

-   **主机优先级**：设置主机使用优先级
-   **自动切换**：主主机失败时自动切换备用主机
-   **连接监控**：定期检查主机连接状态
-   **性能统计**：记录各主机的响应时间

### 配置选项

-   **轮询间隔**：设置连接测试间隔
-   **超时设置**：配置连接超时时间
-   **重试机制**：设置失败重试次数

---

**功能状态**：✅ 已完成
**测试状态**：⏳ 待测试
**优先级**：🟡 中
